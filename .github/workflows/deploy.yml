name: ğŸš€ Deploy planes-solecloud

on:
  push:
    branches:
      - main
      - dev
      - qa

jobs:
  deploy:
    runs-on: self-hosted   # ğŸ‘ˆ tu runner en el servidor

    steps:
      # 1. Clonar el repositorio
      - name: ğŸ“¥ Clonar repositorio
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.ref_name }}

      # 2. Detener y eliminar contenedor existente
      - name: ğŸ›‘ Detener y eliminar contenedor anterior
        run: |
          docker compose stop planes-solecloud || true
          docker compose rm -f planes-solecloud || true

      # 3. Reconstruir y levantar contenedor
      - name: ğŸ”¨ Reconstruir y levantar contenedor
        run: |
          docker compose up -d --build planes-solecloud

      # 4. Mensaje final
      - name: âœ… Mensaje de confirmaciÃ³n
        if: success()
        run: echo "ğŸš€ Deploy completado con Ã©xito en ${{ github.ref_name }}"

      - name: âŒ Mensaje de error
        if: failure()
        run: echo "âŒ FallÃ³ el deploy en ${{ github.ref_name }}"
